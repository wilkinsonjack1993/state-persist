{"version":3,"file":"index.js","sources":["../src/hooks/useStorageState.ts"],"sourcesContent":["import { useState, useEffect } from 'react';\n\nexport const useBaseStorageState = <T>(\n  storage: Storage,\n  storageKey: string,\n  defaultValue: T,\n  live = false\n) => {\n  // Get value from storage, if not use default value\n  const [state, setState] = useState(() => {\n    const storageValue = storage.getItem(storageKey);\n    return storageValue ? JSON.parse(storageValue) : defaultValue;\n  });\n\n  useLiveStorageListners(\n    live,\n    handleStorageEvent(storageKey, setState),\n    storageKey\n  );\n\n  // On change set storage.\n  useEffect(() => {\n    storage.setItem(storageKey, JSON.stringify(state));\n  }, [storageKey, state]);\n\n  const clear = () => {\n    storage.removeItem(storageKey);\n  };\n\n  const setStateExternal = setStateBuilder(state, setState, live, storageKey);\n\n  return [state, setStateExternal, clear];\n};\n\nexport const useStorageState = <T>(storageKey: string, defaultValue: T) =>\n  useBaseStorageState(localStorage, storageKey, defaultValue, false);\n\nexport const useLiveStorageState = <T>(storageKey: string, defaultValue: T) =>\n  useBaseStorageState(localStorage, storageKey, defaultValue, true);\n\nexport const useSessionState = <T>(storageKey: string, defaultValue: T) =>\n  useBaseStorageState(sessionStorage, storageKey, defaultValue, false);\n\nexport const useLiveSessionState = <T>(storageKey: string, defaultValue: T) =>\n  useBaseStorageState(sessionStorage, storageKey, defaultValue, true);\n\nfunction setStateBuilder<T>(\n  state: T,\n  setState: (newState: T) => void,\n  live: boolean,\n  storageKey: string\n) {\n  return (newState: T) => {\n    const oldValue = JSON.stringify(state);\n    setState(newState);\n    if (live) {\n      const event = new StorageEvent(`state-persist-${storageKey}`, {\n        key: storageKey,\n        oldValue,\n        newValue: JSON.stringify(newState)\n      });\n      window.dispatchEvent(event);\n    }\n  };\n}\n\nfunction useLiveStorageListners(\n  live: boolean,\n  handleStorageEvent: (evt: StorageEvent) => void,\n  storageKey: string\n) {\n  useEffect(() => {\n    if (live) {\n      window.addEventListener('storage', handleStorageEvent);\n      window.addEventListener(\n        `state-persist-${storageKey}`,\n        handleStorageEvent\n      );\n      return () => {\n        window.removeEventListener('storage', handleStorageEvent);\n        window.removeEventListener(\n          `state-persist-${storageKey}`,\n          handleStorageEvent\n        );\n      };\n    } else {\n      window.removeEventListener('storage', handleStorageEvent);\n    }\n    return;\n  }, [live, storageKey]);\n}\n\nexport function handleStorageEvent<T>(\n  storageKey: string,\n  setState: (newState: T) => void\n) {\n  return (evt: StorageEvent) => {\n    if (evt.key === storageKey && evt.newValue !== evt.oldValue) {\n      setState(evt.newValue ? JSON.parse(evt.newValue) : evt.newValue);\n    }\n  };\n}\n"],"names":["useEffect"],"mappings":"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"}